name: "aws-shield"
# Canonical GitHub repo
github_repo: "cloudposse-terraform-components/aws-shield"
# Short description of this project
description: |-
  This component is responsible for enabling AWS Shield Advanced Protection for the following resources:

  - Application Load Balancers (ALBs)
  - CloudFront Distributions
  - Elastic IPs (NAT Gateways, EC2 instances)
  - Route53 Hosted Zones

  ## About AWS Shield

  AWS Shield is a managed DDoS (Distributed Denial of Service) protection service that safeguards applications running on AWS.

  **AWS Shield has two tiers:**

  | Feature | Shield Standard | Shield Advanced |
  |---------|-----------------|-----------------|
  | **Cost** | Free (included with AWS) | $3,000/month per organization |
  | **Protection** | Layer 3/4 (network/transport) | Layer 3/4/7 (includes application layer) |
  | **Resources** | All AWS resources | Specific protected resources |
  | **DRT Access** | No | Yes (24/7 DDoS Response Team) |
  | **Cost Protection** | No | Yes (credits for DDoS-related scaling) |
  | **Advanced Metrics** | No | Yes (CloudWatch metrics) |
  | **WAF Integration** | Basic | Advanced (custom rules during attacks) |

  This component configures **AWS Shield Advanced** protection for specific resources.

  ## Prerequisites

  This component requires that the account where it is being provisioned has been
  [subscribed to AWS Shield Advanced](https://docs.aws.amazon.com/waf/latest/developerguide/enable-ddos-prem.html).

  **Important:** The Shield Advanced subscription is a **manual step** that must be completed before deploying this component:

  ```shell
  # Subscribe via AWS CLI
  aws shield create-subscription

  # Or subscribe via AWS Console:
  # AWS Shield → Getting started → Subscribe to Shield Advanced
  ```

  This component assumes that resources it is configured to protect are not already protected by other components that
  have their `xxx_aws_shield_protection_enabled` variable set to `true`.

usage: |-
  **Stack Level**: Global or Regional

  AWS Shield Advanced protects both global and regional resources. Deploy this component to the appropriate stack level
  based on the resources you want to protect:

  | Resource Type | Stack Level | Example Stack |
  |---------------|-------------|---------------|
  | Route53 Hosted Zones | Global | `plat-gbl-prod-shield` |
  | CloudFront Distributions | Global | `plat-gbl-prod-shield` |
  | Application Load Balancers | Regional | `plat-use1-prod-shield` |
  | Elastic IPs | Regional | `plat-use1-prod-shield` |

  ### Complete Example (All Resources)

  The following snippet shows how to use all of this component's features in a stack configuration:

  ```yaml
  components:
    terraform:
      aws-shield:
        metadata:
          component: aws-shield
        settings:
          spacelift:
            workspace_enabled: true
        vars:
          enabled: true
          # Global resources
          route53_zone_names:
            - example.com
            - api.example.com
          cloudfront_distribution_ids:
            - E1ABCDEFG12345
            - E2BCDEFGH23456
          # Regional resources
          alb_protection_enabled: true
          alb_names:
            - k8s-common-2c5f23ff99
            - api-gateway-alb
          eips:
            - 3.214.128.240    # NAT Gateway AZ-a
            - 35.172.208.150   # NAT Gateway AZ-b
            - 35.171.70.50     # Bastion host
  ```

  ### Global Stack Configuration

  A typical global configuration includes Route53 hosted zones and CloudFront distributions.
  Global stacks typically don't have a VPC, so `alb_names` and `eips` should not be defined:

  ```yaml
  # stacks/catalog/aws-shield/global.yaml
  components:
    terraform:
      aws-shield:
        metadata:
          component: aws-shield
        settings:
          spacelift:
            workspace_enabled: true
        vars:
          enabled: true
          route53_zone_names:
            - example.com
            - internal.example.com
          cloudfront_distribution_ids:
            - E1ABCDEFG12345
  ```

  ### Regional Stack Configuration

  Regional configurations protect ALBs and Elastic IPs. CloudFront distributions should not be defined
  in regional stacks (they are global resources):

  ```yaml
  # stacks/catalog/aws-shield/regional.yaml
  components:
    terraform:
      aws-shield:
        metadata:
          component: aws-shield
        settings:
          spacelift:
            workspace_enabled: true
        vars:
          enabled: true
          # Protect ALBs by name
          alb_protection_enabled: true
          alb_names:
            - k8s-common-2c5f23ff99
          # Protect Elastic IPs (NAT Gateways, EC2 instances)
          eips:
            - 3.214.128.240
            - 35.172.208.150
          # Regional Route53 zones (if any)
          route53_zone_names:
            - us-east-1.example.com
  ```

  ### Auto-Discovery from EKS ALB Controller

  When `alb_protection_enabled` is `true` and `alb_names` is empty, the component automatically discovers
  ALB names from the `eks/alb-controller-ingress-group` component via remote state:

  ```yaml
  components:
    terraform:
      aws-shield:
        vars:
          enabled: true
          # Enable ALB protection with auto-discovery
          alb_protection_enabled: true
          # alb_names is intentionally empty - will be discovered from EKS ALB controller
  ```

  ### Catalog Defaults Pattern

  Create a catalog defaults file that can be imported and customized per environment:

  ```yaml
  # stacks/catalog/aws-shield/defaults.yaml
  components:
    terraform:
      aws-shield:
        metadata:
          component: aws-shield
        vars:
          enabled: true
          alb_protection_enabled: false
          alb_names: []
          eips: []
          route53_zone_names: []
          cloudfront_distribution_ids: []
  ```

  Then import and override in your stack:

  ```yaml
  # stacks/orgs/acme/platform/prod/us-east-1/shield.yaml
  import:
    - catalog/aws-shield/defaults

  components:
    terraform:
      aws-shield:
        vars:
          alb_protection_enabled: true
          alb_names:
            - prod-api-alb
          eips:
            - 52.1.2.3
  ```

  ### Integration with Other Components

  Stack configurations that rely on components with a `xxx_aws_shield_protection_enabled` variable should set that
  variable to `true` and leave the corresponding variable for this component empty, relying on that component's AWS
  Shield Advanced functionality instead. This simplifies inter-component dependencies and minimizes the need
  for maintaining the provisioning order during a cold-start.

  ### Finding Resource Identifiers

  Use the following AWS CLI commands to find resource identifiers:

  ```shell
  # List ALB names
  aws elbv2 describe-load-balancers --query 'LoadBalancers[*].LoadBalancerName' --output table

  # List Elastic IPs
  aws ec2 describe-addresses --query 'Addresses[*].[PublicIp,AllocationId,Tags[?Key==`Name`].Value|[0]]' --output table

  # List Route53 hosted zones
  aws route53 list-hosted-zones --query 'HostedZones[*].[Name,Id]' --output table

  # List CloudFront distributions
  aws cloudfront list-distributions --query 'DistributionList.Items[*].[Id,DomainName,Origins.Items[0].DomainName]' --output table
  ```

  ### Verifying Protection Status

  After deployment, verify resources are protected:

  ```shell
  # List all protected resources
  aws shield list-protections --query 'Protections[*].[Name,ResourceArn]' --output table

  # Describe a specific protection
  aws shield describe-protection --resource-arn <resource-arn>

  # Check subscription status
  aws shield describe-subscription
  ```

  <!-- prettier-ignore-start -->
  <!-- prettier-ignore-end -->

references:
  - name: "AWS Shield Documentation"
    url: "https://docs.aws.amazon.com/shield/"
    description: "Official AWS Shield documentation"
  - name: "AWS Shield Advanced Developer Guide"
    url: "https://docs.aws.amazon.com/waf/latest/developerguide/shield-chapter.html"
    description: "Comprehensive guide for AWS Shield Advanced features and configuration"
  - name: "Subscribing to AWS Shield Advanced"
    url: "https://docs.aws.amazon.com/waf/latest/developerguide/enable-ddos-prem.html"
    description: "Step-by-step instructions for subscribing to Shield Advanced"
  - name: "AWS Shield Pricing"
    url: "https://aws.amazon.com/shield/pricing/"
    description: "Pricing details for AWS Shield Advanced ($3,000/month per organization)"
  - name: "DDoS Response Team (DRT) Support"
    url: "https://docs.aws.amazon.com/waf/latest/developerguide/ddos-srt-support.html"
    description: "How to engage AWS DDoS Response Team during attacks"
  - name: "AWS Best Practices for DDoS Resiliency"
    url: "https://docs.aws.amazon.com/whitepapers/latest/aws-best-practices-ddos-resiliency/welcome.html"
    description: "AWS whitepaper on DDoS mitigation best practices"
  - name: "Terraform aws_shield_protection Resource"
    url: "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/shield_protection"
    description: "Terraform documentation for the aws_shield_protection resource"
  - name: "cloudposse-terraform-components"
    url: "https://github.com/orgs/cloudposse-terraform-components/repositories"
    description: "Cloud Posse's upstream component repository"

tags:
  - component/aws-shield
  - layer/security-and-compliance
  - provider/aws

# Categories of this project
categories:
  - component/aws-shield
  - layer/security-and-compliance
  - provider/aws

# License of this project
license: "APACHE2"

# Badges to display
badges:
  - name: Latest Release
    image: https://img.shields.io/github/release/cloudposse-terraform-components/aws-shield.svg?style=for-the-badge
    url: https://github.com/cloudposse-terraform-components/aws-shield/releases/latest
  - name: Slack Community
    image: https://slack.cloudposse.com/for-the-badge.svg
    url: https://slack.cloudposse.com

related:
  - name: "terraform-aws-waf"
    description: "Terraform module to create and manage AWS WAF rules for additional application-layer protection"
    url: "https://github.com/cloudposse/terraform-aws-waf"
  - name: "aws-wafv2 Component"
    description: "Cloud Posse component for AWS WAFv2, often used alongside Shield Advanced"
    url: "https://github.com/cloudposse-terraform-components/aws-wafv2"
  - name: "Cloud Posse Terraform Modules"
    description: "Our collection of reusable Terraform modules used by our reference architectures."
    url: "https://docs.cloudposse.com/modules/"
  - name: "Atmos"
    description: "Atmos is like docker-compose but for your infrastructure"
    url: "https://atmos.tools"

contributors: [] # If included generates contribs
